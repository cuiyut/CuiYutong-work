<h1>Vue配置</h1>
### vue-cli2和vue-cli3

- vue-cli3 是基于webpack4的, vue-cli2是基于webpack3
- vue-cli3的设计原则是"0配置", 移除了配置文件根目录下build和config等目录
- vue-cli3 提供了vue ui命令, 进行可视化配置, 操作更方便
- 替换了static文件夹为public文件夹, 并且index.html移动到public文件夹中



### vue-cli3搭建项目

- #### 创建：vue create 名字

  - ###### 选择手动配置：Manually select features

    ```jade
    ? Please pick a preset: (Use arrow keys)         // 请选择一个配置
    ❯ Default ([Vue 3] babel, eslint)			 // 默认配置,vue3.0
      Default ([Vue 2] babel, eslint)           // 默认配置,vue2.0
      Manually select features                 // 手动选择
    ```

  - ###### 进行项目选项配置：需要什么选什么

    ```jade
    ? Please pick a preset: Manually select features  //请选择项目配置
    ? Check the features needed for your project: (Press <space> to select, <a> to toggle all, <i> to invert selection, and <enter> to proceed)                 // 选择你需要的配置放在项目里面,按enter键结束
    ❯◉ Babel                                 // 转换工具,将es6转换成es5
     ◯ TypeScript                            // TS
     ◯ Progressive Web App (PWA) Support     // 渐进式Web应用程序
     ◯ Router	                             // vue-router（vue路由）
     ◯ Vuex	                                 // vuex（vue的状态管理模式）
     ◯ CSS Pre-processors	                 // CSS 预处理器
     ◉ Linter / Formatter                    // 代码风格检查和格式化
     ◯ Unit Testing	                        // 单元测试（unit tests）
     ◯ E2E Testing                          // e2e（end to end） 测试
    ```

  - ###### vue版本：选择版本

    ```jade
    ? Choose a version of Vue.js that you want to start the project with
      3.x
    ❯ 2.x
    ```

  - ###### 使用hash还是hitory路由（选择hash）

    ```jade
    Use history mode for router? (Requires proper server setup for index fallback in production) (Y/n) N              
    ```

  - ###### 选择css预处理的方式：Sass/SCSS (with dart-sass)

    ```jade
    ? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): (Use arrow keys)       // css预处理器
    ❯ Sass/SCSS (with dart-sass)				
      Less
      Stylus
    ```

  - ###### 语法检测工具： ESLint + Prettier

    ```jade
    ? Pick a linter / formatter config: (Use arrow keys) // 语法检测工具
    ❯ ESLint with error prevention only                  // 仅错误预防
      ESLint + Airbnb config  						// config Airbnb配置
      ESLint + Standard config 						// config 标准配置
      ESLint + Prettier 							// 该配置应该比较完善
    ```

  - ###### 语法检测方式：Lint and fix on commit

    ```jade
    ? Pick additional lint features: (Press <space> to select, <a> to toggle all, <i> to invert selection, and <enter> to proceed
    ❯◉ Lint and fix on commit  
     ◯ Lint on save  
    ```

    - **Lint and fix on commit**：代码除了语法错误导致的 error 外不会提示 warning。而是在当前项目进行 git commit 操作的时候，通过 githook，在 pre-commit 阶段执行 lint 和 fix 操作，自动帮我们把有语法错误的地方修改为符合规范
    - **Lint on save**：代码文件中有代码不符合 lint 规则时，会在 compile 阶段提示 warning。如果出现了语法错误，会直接在页面上显示 error

  - ###### 配置文件放在那里：In dedicated config files

    ```jade
    Where do you prefer placing config for Babel, ESLint, etc.?
    In dedicated config files     // 独立文件，方便管理
    In package.json               // 放到package.json中
    ```

  - ###### 是否将刚刚的配置保存到项目中

    ```jade
    Save this as a preset for future projects? (y/N)  N
    ```

    - 下次搭建项目时，就可以自动选择之前保存的：mySet([Vue 2] balel)

      ```jade
      ? Please pick a preset:(Use arrow keys)
      ❯mySet([Vue 2] balel)
       Default([Vue 2] babel,eslint)
       Default(Vue 3 Preview) ([Vue 3] babel,eslint)
       Manually select features
      ```

    - 如何取消：/Users/用户名/.vuerc

      ```js
      {
        "useTaobaoRegistry": false,
        "presets": {
          "mySet": {
            "useConfigFiles": true,
            "plugins": {
              "@vue/cli-plugin-babel": {}
            },
            "vueVersion": "2"
          }
        }
      }
      ```

      “presets”只留一个@vue/cli-plugin-babel

  #### PWA：Progressive Web App

  - 一是给项目添加一些webapp支持，二是增加可离线支持
  - 三个特点：可靠、快速响应、像设备上的原生应用
  - https://juejin.cn/post/6844904033522548743

  #### 对于单元测试的理解

  - 当数据处理的复杂性较高的时候,需要用到单元测试

  - https://juejin.cn/post/7039108357554176037

  #### E2E单元测试

  - https://blog.csdn.net/u012961419/article/details/123821205

  #### scss预处理

  - https://www.jianshu.com/p/81aec65cccea



### vue-cli3项目中各个文件含义

- **node_modules**: npm构建的组件都在这个文件夹里面
- **public**: 里面存放公共资源
- **src**: 存放源代码
- **.browserslitstrc**: 浏览器适配配置
- **gitignore**: 忽略文件
- **babel.config.js**: babel插件设置
- **package.json**: npm配置文件
- **package-lock.json**: 真实使用的插件的版本号



### 代码规范校验

- #### editorconfig

  - ###### 下载插件

    ![](https://img-blog.csdnimg.cn/e93aeb38884342babfa64ee4b1b07abb.png)

  - 新建一个 .editorconfig文件

    ```js
    # http://editorconfig.org
    
    root = true
    
    [*] 				# 表示所有文件适用
    charset = utf-8 	# 设置文件字符集为 utf-8
    indent_style = tab  # 缩进风格（tab | space）
    indent_size = 2 	# 缩进大小
    end_of_line = lf 	# 控制换行类型(lf | cr | crlf)
    trim_trailing_whitespace = true 	# 去除行首的任意空白字符
    insert_final_newline = true  		# 始终在文件末尾插入一个新行
     
    [*.md] 				# 表示仅 md 文件适用以下规则
    max_line_length = off
    trim_trailing_whitespace = false
    ```

- #### 使用prettier工具

  - ###### 安装

    ```
    npm install prettier -D
    ```

  - ###### 配置 .prettierrc文件

    ```
    {
      "useTabs": false,				//使用tab缩进还是空格缩进
      "tabWidth": 2,				//tab空格的情况下，几个空格
      "printWidth": 80,				//当行字符的长度
      "singleQuote": true,			//使用单引(true)还是双引(false)
      "trailingComma": "none",		//在多行输入的尾逗号是否添加
      "semi": false 				//语句末尾是否加分号，默认true
    }
    ```

  - ###### 创建 .prettierignore忽略文件

    ```
    /dist/*
    .local
    .output.js
    /node_modules/**
    
    **/*.svg
    **/*.sh
    
    /public/*
    ```

  - ###### 安装prettier插件

    ![](https://img-blog.csdnimg.cn/3ba1447638474804acc25c0d6b3d41be.png)

  - ###### 测试prettier是否生效

    ```
    //在package.json中配置一个scripts
    
    "prettier": "prettier --write ."
    
    
    //执行命令，可以将所有文件格式化
    npm run prettier
    ```

- #### eslint

  - ###### eslint可以自动帮我们格式化，Vue会默认帮助我们配置需要的ESLint环境

    ![](https://img-blog.csdnimg.cn/img_convert/b6fea218aa6bfd74605ca6dcbc9be237.png)

  - ###### 解决eslint和prettier冲突的问题

    - 安装插件

      ```
      npm i eslint-plugin-prettier eslint-config-prettier -D
      ```

    - 在.eslintrc.js

      ```
        extends: [
          "plugin:vue/vue3-essential",
          "eslint:recommended",
          "@vue/typescript/recommended",
          "@vue/prettier",
          "@vue/prettier/@typescript-eslint",
          'plugin:prettier/recommended'
        ],
      ```

- #### git Husky和eslint
  - 需要在执行 git commit 命令时候进行校验，如果不符合eslint规范，自动通过规范修复

  - 使用husky

    ```
    npx husky-init && npm install
    ```

    - 下载以后会做三件事

      ```
      
      ```

      







### Eslint和prettier，vscode配置

- #### setting.json中

  ```
  // prettier 格式化配置
      "javascript.format.placeOpenBraceOnNewLineForControlBlocks": false, // 函数左括号{是否换行
        "javascript.format.insertSpaceBeforeFunctionParenthesis": true, // 让函数(名)和后面的括号之间加个空格
        "prettier.printWidth": 80,
        "prettier.tabWidth": 2,
        "prettier.useTabs": true,
        "prettier.singleQuote": true,
        "prettier.jsxSingleQuote": true,
        "prettier.quoteProps": "consistent",
        "prettier.trailingComma": "all",
        "prettier.bracketSpacing": true,
        "prettier.jsxBracketSameLine": false,
        "prettier.arrowParens": "always",
        "prettier.semi": true,
        "prettier.requirePragma": false,
        "prettier.insertPragma": false,
        "prettier.proseWrap": "preserve",
        "prettier.htmlWhitespaceSensitivity": "ignore",
        "prettier.endOfLine": "auto",
        "prettier.vueIndentScriptAndStyle": true,
        // https://prettier.io/docs/en/options.html 官方文档
        // https://juejin.im/post/5a7d70496fb9a063317c47f1 中文翻译
        // https://segmentfault.com/a/1190000012909159
        // https://www.jianshu.com/p/4be58a69b20f
        // ---------------------------------------------------
       
        // ---------------------------------------------------
        // ESLint 配置代码检查
        "eslint.format.enable": false,
        "eslint.alwaysShowStatus": false,
        "eslint.quiet": false, // 忽略检查
        "eslint.validate": [
            "javascript",
            "javascriptreact",
            "typescript",
            "typescriptreact",
            "vue",
        ],
        "eslint.run": "onSave",
        "eslint.options": {
            "extensions": [
                ".js",
                ".vue",
            ],
        },
        "editor.codeActionsOnSave": { // 启用 eslint 自动修复
            "source.fixAll.eslint": true
        }
  ```



### vue.config.js配置

- #### 基本配置

  ```js
    // pro -> production (生产环境，全量，真机、线上)
    // stage (灰度、备机)
    // test (测试)
    // dev (开发)可以自己使用
  
  module.exports = {
  	productionSourceMap: false,     //生产环境构造
  	lintOnSave: false, 				//保存是否格式化
  	publicPath: './',  				//根目录、值可以是空字符串或相对路径
  	outputDir:'dist',  				//输出文件
  	assetsDir:'static',   			//静态资源
      indexPath:'index.html'			//指定生成的index.html的输出路径，默认空
  	devServer: {
          port: 8089, 				//端口号
          https: false, 				//是否启用线上
          host: '0.0.0.0', 			//localhost的一种写法
          open: false, 				//启动的时候是否直接打开浏览器
          proxy: {
            '/api': {
              changeOrigin: true,				//配置代理默认开启target方式
              target: 'http: //www.baidu.com',  //代理地址
              pathRewrite: {
                '/api': ''
              }
        	  }
      	}
   	 }
  }
  ```

  - ###### 路径别名的配置（有两种形式-> 函数、对象）

    - 函数形式

      ```js
      configureWebpack: () => {
      	return {
        		//路径别名      
      		resolve: {
      			alias: {
      				'@':reslove('src'),
      				vue$: 'vue/dist/vue.esm.js'
      			}
      		}
      	}
      }
      ```

    - 对象形式

      ```js
      configureWebpack: {
        	//路径别名      
      	resolve: {
      		alias: {
      			'@':reslove('src'),
      			vue$: 'vue/dist/vue.esm.js'
      		}
      	}
      }
      ```

  - ###### 对应nginx配置（也可以配置跨域）

    ```js
    http {
    	include        mime.types;
    	default_type   application/octet-stream;
    	sendfile  on;
    
    	server {
    		listen       8081
    		server_name  192.168.10.8
    
    		location / {
    			root       E:/code/web/dist;
    			index      index.html
    			try_files  $uri $uri/ /index.html
    		}
    
    		location/api/ {
    			proxy_pass http://192.168.10.9:8089/; #必须斜杠结尾
    			proxy_set_header  X-Forwarded-Proto $scheme
    			proxy_set_header  Host  $http_host
    			proxy_set_header  X-Real-IP $remote_addr
    		}
    
    		error_page  500 502 503 504 /50x.html
    		location = /50x.html {
    			root  html
    		}
    	}
    }
    ```

- #### 构建多页面配置

  ```js
  modele.exports = {				
      //默认情况下，生成的静态资源的文件名中包含了hash，默认是true，要求index的html是被vue cli自动生成的，如果无法使用，就设置为false
      filenameHashing:false,
      
      //在多页模式下构建应用，每个page都要有对应的js入口文件
      //值应该是一个对象，对象的key是入口的名字
      //pages用于多页配置，默认是undefined
      //在多页应用模式下，webpack配置会存在多个html-webpack-plugin和preload-webpack-plugin实例，如果要修改，要确认运行vue inspect
      pages: {
          index: {
              //page的入口文件
              entry:'src/index/main.js',
              
              //模板文件来源
              template:'public/index.html',
              
              //在dist/index.html的输出文件
              filename:'index.html',
              
              //当使用页面的title选项时
              title:'Index Page',
              
              //提取出来的通用chunk和vendor chunk
              chunks:['chunk-vendors','chunk-common','index'],
          }
      	//使用只有入口的字符串格式，默认是'punlic/subpage.html',不存在就退回'public/index.html',输出文件默认是'subpage.html'
      	subpage:'src/subpage/main.js',
      
      	//保存是否格式化
      	lintOnSave:true,
          
      	//是否包含运行时编译器的vue构建版本
      	runtimeCompiler:false,
          
          //默认babel-loader会忽略所有node_modeles中的文件，如果想要通过Babel显示转译一个依赖，可以在这个里面列出来，默认值是空数组
          transpileDependencies:'',
          
          //如果不需要生辰环境的source map，可以设置为false，可以加速生产环境构建,默认是ture
          productionSourceMap:flase,
          
          //设置生成HTML中link和script标签的crossorigin,默认是undefined
          crossorigin:'',
          
          //在生成的HTML中的link和script标签上启用SRI(Subresource Integrity),默认false
          integrity:false
      }
  }
  ```

- #### 插件及规则配置

  - ###### configureWebpack 方式

    ```js
    configureWebpack: {
    	rules:[],
    	plugins:[]
    }
    configureWebpack:(config) => {
    	//通过判断运行环境，设置mode
    	config.mode = 'production'
    }
    ```

  - ###### chainWebpack 方式

    ```js
    chainWebpack: (config) => {
        config.module
          .rule('vue')
          .use('vue-loader')
          .loader('vue-loader')
          .tap((options) => {
          	options.compilerOptions.preserveWhitespace = true
            return options
          })
          .end()
    },
    
    //如果新增一个rules，那么大概语法为
    config.module
    	.rule('vue')
          .use('vue-loader')
          	.loader('vue-loader')
          	.options((options) 
          .end()
    ```

- #### 最终版本（可以启动）

  ```js
  const { defineConfig } = require('@vue/cli-service')
  const path = require('path')
const resolve = (dir) => path.join(__dirname, '.', dir)
  module.exports = defineConfig({
    transpileDependencies: true,
    lintOnSave: false,
    devServer: {
      proxy: {
        '/api': {
          target: 'http://jsonplaceholder.typicode.com/',
          changeOrigin: true,
          pathRewrite: {
            '^/api': ''
          }
        }
      },
      port: 8089,
      host: '0.0.0.0',
      https: false,
      open: false
    },
    productionSourceMap: false,
    publicPath: './',
    outputDir: 'dist',
    assetsDir: 'static',
    chainWebpack: (config) => {
      config.module
        .rule('vue')
        .use('vue-loader')
        .tap((options) => {
          return options
        })
        .end()
    },
    configureWebpack: {
      resolve: {
        alias: {
          '@': resolve('src'),
          vue$: 'vue/dist/vue.esm.js'
        }
      }
    }
  })
  ```
  
  

























